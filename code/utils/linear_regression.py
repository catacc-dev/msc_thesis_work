import pandas as pd
import statsmodels.api as sm
import researchpy as rp

def linear_regression_stats(df, region):
    
    # Add intercept
    X = df[['factor']] # independent variable(s)
    X = sm.add_constant(X)
    
    print(f"\nRegion tested: {region}")
    metrics = ['psnr', 'mae', 'ssim', 'msssim']
    
    for metric in metrics:
        y = df[metric] # dependent variable
        
        # Fit linear regression model
        fit_lm = sm.OLS(y, X).fit()
        print(f"\n=== Results for {metric.upper()} ===")
        # Show results
        print(fit_lm.summary())
        
        ## t-test in reserachpy
        group1 = df[df['factor'] == 1][metric]
        group2 = df[df['factor'] == 0][metric]
        
        print("\n=== T-Test Groups ===")
        print(f"1region: Group 1 (n={len(group1)}): Mean={group1.mean():.2f}, SD={group1.std():.2f}")
        print(f"Allregions: Group 2 (n={len(group2)}): Mean={group2.mean():.2f}, SD={group2.std():.2f}")
        
        summary, results = rp.ttest(group1=group1, group2=group2)
        print("\nT-Test Results:")
        print(summary)
        print(results)
            
        
#  model trained in AB and ATHHN and tested in only AB

metrics_trained_ab_tested_ab={'psnr': [30.849428176879883, 30.228397369384766, 28.48882484436035, 28.93585968017578, 31.793701171875, 23.300691604614258, 30.365779876708984, 24.46687889099121, 25.181766510009766, 20.573686599731445, 26.43626594543457, 25.704404830932617, 25.164588928222656, 29.316452026367188, 28.94927406311035, 29.204639434814453], 
                              'mae': [121.84847259521484, 99.26726531982422, 107.74688720703125, 104.37852478027344, 89.59425354003906, 120.9578628540039, 101.97882080078125, 143.14675903320312, 164.28187561035156, 185.42210388183594, 77.59738159179688, 76.46794891357422, 98.87532806396484, 126.30406951904297, 81.43370056152344, 127.54466247558594], 
                              'ssim': [0.9479538202285767, 0.9516535997390747, 0.9383426308631897, 0.9249261021614075, 0.9539374709129333, 0.8726556897163391, 0.9452541470527649, 0.9032584428787231, 0.9106677174568176, 0.8863967657089233, 0.9140722155570984, 0.8967678546905518, 0.9183997511863708, 0.9582182765007019, 0.9491469860076904, 0.9548541307449341], 
                              'msssim': [0.9468780159950256, 0.9009271264076233, 0.8722265958786011, 0.8514261841773987, 0.9463418126106262, 0.8121547102928162, 0.922061562538147, 0.8566140532493591, 0.8799892663955688, 0.836444079875946, 0.9112815856933594, 0.8774720430374146, 0.9090564250946045, 0.9566724300384521, 0.9013171792030334, 0.8927536606788635]}
metrics_trained_all_tested_ab={'psnr': [31.372955322265625, 30.334810256958008, 28.480295181274414, 29.233911514282227, 32.431739807128906, 23.345863342285156, 30.314849853515625, 24.283403396606445, 25.2143497467041, 20.374231338500977, 26.342695236206055, 26.0709171295166, 25.15595054626465, 30.901456832885742, 29.084434509277344, 28.943267822265625], 
                               'mae': [107.1502685546875, 95.79072570800781, 102.57666778564453, 96.2986068725586, 81.44854736328125, 118.43985748291016, 100.65886688232422, 145.6038818359375, 157.55490112304688, 186.9632568359375, 78.76509857177734, 72.22086334228516, 98.19991302490234, 83.31649017333984, 78.72718048095703, 128.6063690185547], 
                               'ssim': [0.9489338397979736, 0.9511246681213379, 0.9386395812034607, 0.92662113904953, 0.9552656412124634, 0.8723728656768799, 0.9443963766098022, 0.9005083441734314, 0.9102858304977417, 0.887773334980011, 0.9150210022926331, 0.9003283977508545, 0.9189815521240234, 0.9631654024124146, 0.9496341943740845, 0.9530847072601318], 
                               'msssim': [0.9519472718238831, 0.9030585885047913, 0.8818872570991516, 0.8619612455368042, 0.9510794878005981, 0.8178033828735352, 0.9236156344413757, 0.8539150357246399, 0.8824064135551453, 0.8418336510658264, 0.9156664609909058, 0.8880042433738708, 0.9135861396789551, 0.9690083265304565, 0.9068989753723145, 0.8934154510498047]}

df_ab = pd.DataFrame(metrics_trained_ab_tested_ab)
df_all = pd.DataFrame(metrics_trained_all_tested_ab)

# Add model identifier
df_ab['model_trained_in_region'] = 'AB'
df_ab["factor"]=1
df_all['model_trained_in_region'] = 'ABTHHN'
df_all["factor"]=0
df = pd.concat([df_ab, df_all])
print(df)
linear_regression_stats(df, "AB")

#  model trained in HN and ATHHN and tested in HN and HN (external)

metrics_trained_all_tested_hn={'psnr': [32.148502349853516, 23.819778442382812, 30.80272102355957, 28.238704681396484, 25.799854278564453, 32.26179122924805, 33.54786682128906, 30.135772705078125, 28.998632431030273, 29.47173500061035, 25.789621353149414, 28.481433868408203, 29.068605422973633, 28.201852798461914, 27.399980545043945], 'mae': [125.6527099609375, 202.67723083496094, 98.8506088256836, 102.4793472290039, 123.09042358398438, 112.47914123535156, 108.55093383789062, 136.58668518066406, 118.06346130371094, 150.4703369140625, 300.3505859375, 150.6366729736328, 157.96571350097656, 183.83663940429688, 182.00631713867188], 'ssim': [0.964503824710846, 0.9010844826698303, 0.939026951789856, 0.9339690208435059, 0.8936170339584351, 0.9668880701065063, 0.9716770052909851, 0.9460894465446472, 0.9551103115081787, 0.9371389746665955, 0.9296559691429138, 0.9352394342422485, 0.9326919913291931, 0.9391664266586304, 0.9271188974380493], 'msssim': [0.9600241184234619, 0.8734918236732483, 0.9475006461143494, 0.9418619275093079, 0.8784759044647217, 0.9646351337432861, 0.9722435474395752, 0.9357700347900391, 0.9541733860969543, 0.9361709356307983, 0.8911221027374268, 0.9207918643951416, 0.9176177382469177, 0.9123610854148865, 0.9037604928016663]}
#metrics_trained_all_tested_hnD={'psnr': [30.02497673034668, 28.801040649414062, 30.679039001464844, 29.81398582458496, 31.826663970947266, 27.37826919555664, 31.027315139770508, 29.839448928833008, 29.97528076171875, 31.05066680908203, 29.599916458129883, 30.97001838684082, 30.29273796081543, 28.549875259399414, 28.891040802001953, 31.401569366455078, 30.819198608398438, 32.615535736083984, 28.36410903930664, 29.923860549926758, 30.029674530029297, 27.237041473388672, 30.062700271606445, 28.419979095458984, 28.145490646362305, 30.40563201904297, 29.975618362426758, 26.91271209716797, 29.473289489746094, 27.587467193603516, 30.14862823486328, 30.872819900512695, 30.202302932739258, 31.11516571044922, 28.089664459228516, 28.37690544128418, 28.500776290893555, 28.06121826171875, 27.745311737060547, 27.26854133605957, 30.553966522216797, 31.436349868774414, 28.6310977935791, 28.25169563293457, 30.51814842224121, 27.719579696655273, 30.661134719848633, 30.461711883544922, 29.472482681274414, 30.978750228881836, 30.18952751159668, 31.214595794677734, 32.56874465942383, 31.553466796875, 27.16517448425293, 32.121212005615234, 30.758718490600586, 27.98971939086914, 31.622116088867188, 30.464494705200195, 26.544639587402344, 29.09994888305664, 30.48611068725586, 29.877918243408203, 27.11379051208496], 'mae': [117.75301361083984, 124.45343780517578, 106.54193878173828, 108.99964904785156, 99.60943603515625, 128.98069763183594, 104.56517028808594, 126.50857543945312, 113.05111694335938, 99.11309814453125, 124.304931640625, 112.05681610107422, 116.68476104736328, 99.58320617675781, 99.09685516357422, 96.19935607910156, 103.63761138916016, 91.60979461669922, 95.03780364990234, 112.99617767333984, 108.17926025390625, 137.47625732421875, 127.71797943115234, 118.30028533935547, 134.70326232910156, 114.8283920288086, 112.1040267944336, 113.91206359863281, 103.24759674072266, 110.40933990478516, 113.67483520507812, 105.80833435058594, 107.45277404785156, 114.9148178100586, 104.91106414794922, 105.08782958984375, 105.23313903808594, 97.86133575439453, 114.97118377685547, 115.83981323242188, 109.3812026977539, 96.67793273925781, 106.83384704589844, 111.21062469482422, 118.21675872802734, 107.69112396240234, 104.291748046875, 109.76548767089844, 118.35639953613281, 101.83843994140625, 114.78589630126953, 100.05337524414062, 89.1600341796875, 100.15035247802734, 116.81261444091797, 102.45902252197266, 107.0198745727539, 179.80775451660156, 105.19773864746094, 102.12904357910156, 146.680908203125, 115.90562438964844, 99.94254302978516, 109.6898193359375, 127.61874389648438], 'ssim': [0.9354264736175537, 0.9319342970848083, 0.9389767646789551, 0.9329516887664795, 0.9481948018074036, 0.9272951483726501, 0.9452986121177673, 0.9374998211860657, 0.9405375123023987, 0.9451059699058533, 0.9364463090896606, 0.9408302903175354, 0.9395532608032227, 0.9304103851318359, 0.9448473453521729, 0.9461272358894348, 0.9371828436851501, 0.9540221691131592, 0.9369262456893921, 0.9321345090866089, 0.928092360496521, 0.9227954149246216, 0.9388892650604248, 0.9358631372451782, 0.9193009734153748, 0.9402607083320618, 0.9378352761268616, 0.9091561436653137, 0.9420842528343201, 0.9223830699920654, 0.9432151913642883, 0.9448381066322327, 0.9385594725608826, 0.943978488445282, 0.9264315962791443, 0.9334591627120972, 0.9251964688301086, 0.9222905039787292, 0.9270231127738953, 0.9168186783790588, 0.9464913606643677, 0.9506675004959106, 0.9294023513793945, 0.9329342842102051, 0.940641462802887, 0.9238615036010742, 0.9413740038871765, 0.9382932782173157, 0.9297019839286804, 0.9460328817367554, 0.9380992650985718, 0.942524790763855, 0.9559657573699951, 0.9441662430763245, 0.9255092144012451, 0.9503706097602844, 0.9398123025894165, 0.933356761932373, 0.9459037184715271, 0.9389763474464417, 0.9257770776748657, 0.9256522059440613, 0.9362927079200745, 0.932539165019989, 0.9247245192527771], 'msssim': [0.9319452047348022, 0.9286759495735168, 0.9439517259597778, 0.9287232756614685, 0.9573501348495483, 0.9351407289505005, 0.9484448432922363, 0.9415697455406189, 0.9342451095581055, 0.9483053684234619, 0.9391894340515137, 0.9477308392524719, 0.9399240016937256, 0.9376636743545532, 0.9523565769195557, 0.9437294006347656, 0.9359999895095825, 0.9611797332763672, 0.9362986087799072, 0.9324758052825928, 0.9273593425750732, 0.9305893182754517, 0.9438544511795044, 0.9440099596977234, 0.9001050591468811, 0.9475985765457153, 0.942077100276947, 0.9053525924682617, 0.9520241022109985, 0.92282634973526, 0.9414820075035095, 0.9534929990768433, 0.9397612810134888, 0.948753297328949, 0.9321178793907166, 0.9320235252380371, 0.9345163106918335, 0.9205615520477295, 0.9301464557647705, 0.9161552786827087, 0.9484109878540039, 0.9565796852111816, 0.9347251653671265, 0.9436883330345154, 0.9483984112739563, 0.9186516404151917, 0.9417725205421448, 0.9444736838340759, 0.9262911081314087, 0.9488796591758728, 0.9433686137199402, 0.9402043223381042, 0.9612693786621094, 0.9533777236938477, 0.92887282371521, 0.9584242105484009, 0.9452582597732544, 0.9168506264686584, 0.9550580382347107, 0.9349995255470276, 0.9185740947723389, 0.9187986850738525, 0.9335432648658752, 0.9256263971328735, 0.9305301308631897]}
metrics_trained_hn_tested_hn={'psnr': [32.18075180053711, 23.766881942749023, 31.088329315185547, 28.35807228088379, 25.64392852783203, 32.21796417236328, 33.81100845336914, 30.25312614440918, 29.168476104736328, 29.60970687866211, 25.92349624633789, 28.46002960205078, 29.224414825439453, 28.235952377319336, 27.593406677246094], 'mae': [127.39239501953125, 202.80532836914062, 94.82339477539062, 103.50334930419922, 125.98619842529297, 118.107666015625, 109.13705444335938, 136.55722045898438, 120.89781951904297, 149.43882751464844, 293.83905029296875, 151.83277893066406, 158.9825897216797, 185.7341766357422, 180.2955322265625], 'ssim': [0.9641085863113403, 0.9004552960395813, 0.943852961063385, 0.9343647360801697, 0.8920647501945496, 0.966552197933197, 0.9716711044311523, 0.94515061378479, 0.9524758458137512, 0.9382984638214111, 0.9299808144569397, 0.9352037906646729, 0.9331353306770325, 0.9387677907943726, 0.9269004464149475], 'msssim': [0.9600141048431396, 0.8736845254898071, 0.9506524205207825, 0.9418683052062988, 0.8730091452598572, 0.9650957584381104, 0.9730557799339294, 0.936933696269989, 0.9546270966529846, 0.9385982751846313, 0.8929265737533569, 0.921492874622345, 0.9198964238166809, 0.9135929346084595, 0.9062720537185669]}
#metrics_trained_hn_tested_hnD={'psnr': [30.030132293701172, 28.981327056884766, 30.767465591430664, 29.799297332763672, 31.890859603881836, 27.444982528686523, 31.088138580322266, 30.054340362548828, 29.87729263305664, 31.119993209838867, 29.720659255981445, 30.832822799682617, 30.43085289001465, 28.44354248046875, 29.09230613708496, 31.447498321533203, 30.765281677246094, 32.72666549682617, 28.080772399902344, 29.86237907409668, 29.971378326416016, 27.38712501525879, 30.160785675048828, 28.36762809753418, 28.17069435119629, 30.489524841308594, 30.113359451293945, 26.703502655029297, 29.47593879699707, 27.39734649658203, 30.371801376342773, 31.0497989654541, 30.167953491210938, 31.0936279296875, 28.04680061340332, 28.502208709716797, 28.51190948486328, 28.00404167175293, 27.73482322692871, 27.348915100097656, 30.610334396362305, 31.680801391601562, 28.681716918945312, 28.412511825561523, 30.597434997558594, 27.662031173706055, 30.712554931640625, 30.63861083984375, 29.225345611572266, 31.074411392211914, 30.597997665405273, 31.15167999267578, 32.53651428222656, 31.595510482788086, 27.24847984313965, 31.946733474731445, 30.661026000976562, 27.98875617980957, 31.697769165039062, 30.4376277923584, 26.324857711791992, 28.933603286743164, 30.397666931152344, 29.883737564086914, 26.911428451538086], 'mae': [122.10408020019531, 128.05545043945312, 110.14417266845703, 113.6499252319336, 104.82904052734375, 131.77537536621094, 107.9130630493164, 126.3058853149414, 123.20799255371094, 101.0763931274414, 129.1065673828125, 120.4986572265625, 120.86614990234375, 105.27144622802734, 103.2582015991211, 100.28840637207031, 106.08092498779297, 96.62699890136719, 102.7256088256836, 117.02503204345703, 113.48870849609375, 139.3677215576172, 138.34188842773438, 124.46144104003906, 136.46029663085938, 118.00965881347656, 113.99634552001953, 120.00946044921875, 108.28777313232422, 118.01517486572266, 116.43531036376953, 107.20635223388672, 111.3075942993164, 120.28315734863281, 109.79365539550781, 112.58596801757812, 111.41438293457031, 103.38214874267578, 117.88208770751953, 119.01176452636719, 111.41371154785156, 98.47163391113281, 110.49298095703125, 113.91105651855469, 120.87480926513672, 112.22833251953125, 108.66140747070312, 111.28101348876953, 127.4129867553711, 103.87179565429688, 114.14779663085938, 107.00788116455078, 93.82328033447266, 104.47991180419922, 117.99839782714844, 109.5, 113.83635711669922, 185.84231567382812, 110.01221466064453, 110.50669860839844, 156.779541015625, 124.10528564453125, 105.29505920410156, 114.63600158691406, 135.21859741210938], 'ssim': [0.9350499510765076, 0.9308596849441528, 0.9390780925750732, 0.9322953820228577, 0.9474964141845703, 0.9269839525222778, 0.945584774017334, 0.9388694167137146, 0.9383566379547119, 0.9449985027313232, 0.9348050951957703, 0.9403238892555237, 0.9416898488998413, 0.9295055866241455, 0.9447099566459656, 0.946006715297699, 0.9368090629577637, 0.954191267490387, 0.9356495141983032, 0.9313061237335205, 0.9276978373527527, 0.9232352375984192, 0.9384676218032837, 0.9348140954971313, 0.9191249012947083, 0.9405934810638428, 0.9382665753364563, 0.9057310223579407, 0.9417070746421814, 0.9200507998466492, 0.9423518776893616, 0.9459362030029297, 0.9377905130386353, 0.9430415034294128, 0.9249818921089172, 0.9338003396987915, 0.9240542650222778, 0.9206098914146423, 0.9266238808631897, 0.9160587191581726, 0.9472185373306274, 0.9514095187187195, 0.9281498193740845, 0.9333092570304871, 0.940674901008606, 0.921917200088501, 0.9412060379981995, 0.9388827681541443, 0.927447497844696, 0.9469057321548462, 0.9395220279693604, 0.9419467449188232, 0.9562516808509827, 0.944182813167572, 0.9258502721786499, 0.9493408799171448, 0.9377513527870178, 0.9331018328666687, 0.9460809230804443, 0.9399781823158264, 0.9240014553070068, 0.9229670166969299, 0.9345117807388306, 0.9322048425674438, 0.9237312078475952], 'msssim': [0.9311119318008423, 0.9287270307540894, 0.9450029730796814, 0.9264264106750488, 0.9578406810760498, 0.9348047375679016, 0.9493752717971802, 0.9441530704498291, 0.931730329990387, 0.9484199285507202, 0.9403694868087769, 0.9457498788833618, 0.9428032040596008, 0.9344499707221985, 0.9539523720741272, 0.9439705014228821, 0.9359282851219177, 0.961152970790863, 0.926790714263916, 0.9305315017700195, 0.9214612245559692, 0.9308058619499207, 0.9451462030410767, 0.9429416656494141, 0.9022769927978516, 0.9476915597915649, 0.9436386227607727, 0.8993139266967773, 0.9513973593711853, 0.9190094470977783, 0.9431087970733643, 0.953713059425354, 0.9393985867500305, 0.9481545090675354, 0.9309802651405334, 0.9322893023490906, 0.9348688721656799, 0.9186704158782959, 0.9297246336936951, 0.9167150855064392, 0.9492812156677246, 0.9579862952232361, 0.9345090985298157, 0.9444945454597473, 0.94908207654953, 0.9164490699768066, 0.9408888220787048, 0.9438416957855225, 0.9229623675346375, 0.9491746425628662, 0.9469356536865234, 0.9386683106422424, 0.9607222080230713, 0.9528151154518127, 0.9303820133209229, 0.957563042640686, 0.9433597922325134, 0.9166530966758728, 0.9540597796440125, 0.9347114562988281, 0.9147693514823914, 0.914982259273529, 0.9312007427215576, 0.9247269034385681, 0.9279074668884277]}

df_hn = pd.DataFrame(metrics_trained_hn_tested_hn)
df_hn['model_trained_in_region']='HN'
df_hn["factor"]=1
df_all_hn = pd.DataFrame(metrics_trained_all_tested_hn)
df_all_hn['model_trained_in_region']='ABTHHN'
df_all_hn["factor"]=0
df_1 = pd.concat([df_hn, df_all_hn])
print(df_1)
linear_regression_stats(df_1, "HN")


#  model trained in TH and ATHHN and tested in only TH

metrics_trained_all_tested_th={'psnr': [28.2620906829834, 26.445547103881836, 30.28302001953125, 29.798870086669922, 31.136627197265625, 29.499561309814453, 28.901430130004883, 31.2586727142334, 27.659259796142578, 26.097360610961914, 25.47817039489746, 27.26093101501465, 30.68647003173828, 27.255815505981445, 26.930540084838867, 28.0704402923584, 26.197175979614258, 29.34001922607422], 'mae': [98.37109375, 215.3752899169922, 148.8822784423828, 147.79153442382812, 93.18193817138672, 135.61383056640625, 97.22513580322266, 104.14727020263672, 111.91387176513672, 98.3960952758789, 145.82374572753906, 149.7581024169922, 101.107666015625, 126.84954071044922, 114.82108306884766, 94.09719848632812, 108.19384002685547, 82.09566497802734], 'ssim': [0.9461876749992371, 0.929672360420227, 0.9526333808898926, 0.9460695385932922, 0.9500104188919067, 0.9500146508216858, 0.9449893236160278, 0.9475071430206299, 0.9455423355102539, 0.9418913722038269, 0.9422894716262817, 0.9359275698661804, 0.9447771310806274, 0.9405157566070557, 0.9404168128967285, 0.9385804533958435, 0.9140511155128479, 0.9526689052581787], 'msssim': [0.9383162260055542, 0.8831565976142883, 0.9417344331741333, 0.9302501678466797, 0.9147228002548218, 0.9233359694480896, 0.9385043382644653, 0.9306886196136475, 0.931113064289093, 0.934929609298706, 0.936027467250824, 0.8873990774154663, 0.9292420148849487, 0.9452009201049805, 0.9394987225532532, 0.9451919198036194, 0.9123425483703613, 0.9528876543045044]}
metrics_trained_th_tested_th={'psnr': [28.015941619873047, 26.40446662902832, 29.6674747467041, 29.652379989624023, 30.788150787353516, 28.805774688720703, 28.48695945739746, 30.95941734313965, 27.269916534423828, 25.7711181640625, 25.6248722076416, 27.499975204467773, 30.746828079223633, 27.31313133239746, 26.9725399017334, 28.036149978637695, 26.342803955078125, 29.181222915649414], 'mae': [102.03559112548828, 213.9657440185547, 156.74954223632812, 150.03823852539062, 101.4387435913086, 149.7906951904297, 107.06871032714844, 110.83235931396484, 119.12054443359375, 101.97938537597656, 144.30960083007812, 140.9183807373047, 101.1785659790039, 128.77847290039062, 115.45121765136719, 95.58765411376953, 105.38369750976562, 85.86734771728516], 'ssim': [0.9450331330299377, 0.929507851600647, 0.9506581425666809, 0.9457492828369141, 0.9487777948379517, 0.9479622840881348, 0.9427932500839233, 0.9460732340812683, 0.94401615858078, 0.9402573704719543, 0.9421745538711548, 0.9356431365013123, 0.9437044858932495, 0.939827561378479, 0.9397768974304199, 0.9381991624832153, 0.9136728644371033, 0.9511499404907227], 'msssim': [0.9351629614830017, 0.8817889094352722, 0.9373642802238464, 0.9289893507957458, 0.9076629877090454, 0.9178730249404907, 0.932461142539978, 0.9251526594161987, 0.9263777732849121, 0.9324557185173035, 0.9352405071258545, 0.8893621563911438, 0.9272169470787048, 0.9446901082992554, 0.9394565224647522, 0.9438513517379761, 0.9108749628067017, 0.9508427977561951]}

df_th = pd.DataFrame(metrics_trained_th_tested_th)
df_th['model_trained_in_region']='TH'
df_th["factor"]=1
df_all_th = pd.DataFrame(metrics_trained_all_tested_th)
df_all_th['model_trained_in_region']='ABTHHN'
df_all_th["factor"]=0
df_2 = pd.concat([df_th, df_all_th])
print(df_2)
linear_regression_stats(df_2, "TH")

